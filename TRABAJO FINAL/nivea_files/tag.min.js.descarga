'use strict';!function(){if(window.swnTagLoaded)return void console.log('swntag:script has been loaded previously in page');window.swnTagLoaded=!0,window.swnDataLayer=window.swnDataLayer||{eventBuffer:[],loadBuffer:[]},window.swnDataLayer._utests=null,window.swnDataLayer.dntDefault=window.swnDataLayer.dnt;var e,t,a=window.navigator.userAgent&&window.navigator.userAgent.indexOf('MSIE ')>0,n='https://wtb-api-hub.swaven.com/tag/v1',r='https://wtb-api-hub.swaven.com/cache/tag/v1',o='https://eu-west-1-wtb-tag-api.swaven.com',i='https://widgets.swaven.com',c='swnSession',s=null,d=null,l={rfr:document.referrer,url:document.location.href,url_pathname:document.location.pathname,pageId:C()},u=['eventBuffer','loadBuffer','push','load','widget_callback','appId'],w=document.createElement('div'),p=null,g=null,f=!1,y={enabled:!1,preview:!1,country:null},h=!1,m=!1,v={},b=!1,_=!1,L=!1,D=[],k=function(){var e=document.currentScript;null==e&&(e=document.querySelector('script[src$="/tag.min.js"]'));if(e){var t=document.createElement('a');return t.href=e.getAttribute('src'),(t.protocol||window.location.protocol)+'//'+(t.host||window.location.host)}return''}(),I=[];w.style.display='none';var x,E={};function C(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,C)}function A(e){(f||y&&y.enabled)&&console.log(e)}E.code='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=',E.encode=function(e,t){t=void 0!==t&&t;var a,n,r,o,i,c,s,d,l=[],u='',w=E.code;if((c=(s=t?Utf8.encode(e):e).length%3)>0)for(;c++<3;)u+='=',s+='\0';for(c=0;c<s.length;c+=3)n=(a=s.charCodeAt(c)<<16|s.charCodeAt(c+1)<<8|s.charCodeAt(c+2))>>18&63,r=a>>12&63,o=a>>6&63,i=63&a,l[c/3]=w.charAt(n)+w.charAt(r)+w.charAt(o)+w.charAt(i);return d=(d=l.join('')).slice(0,d.length-u.length)+u},(x=T('swnAdminParams'))&&(x=x.split(','),(h='true'===x[0])&&(y.enabled='true'===x[1],y.preview='true'===x[2],y.country=x[3])),/swnTagAdmin=(1|true)/i.test(document.location.href)&&!h&&(h=!0,R());var S=[],O=function(e){S.push(e)},j=[],U=function(e){j.push(e)};function T(e){var t=new RegExp(e+'=([^;]+)').exec(document.cookie);return null!=t?unescape(t[1]):null}function R(){var e=h+','+y.enabled+','+y.preview+','+(y.country?y.country:'');document.cookie='swnAdminParams='+e+';path=/'}function B(e,t){var a=o+'/app/'+swnDataLayer.appId+'/track/'+e+'?v='+Date.now()+'&'+function(e){var t,a=[];return Object.keys(e).forEach((function(n){'object'==typeof(t=e[n])&&(t=JSON.stringify(t)),'function'!=typeof t&&a.push(encodeURIComponent(n)+'='+encodeURIComponent(t))})),a.join('&')}(t)+(p&&p.profiling?'&p=1':'');swnDataLayer.dnt?I.push(a+'&flush=1'):q(a)}function q(e){var t=document.createElement('img');t.src=e,t.style.display='none',t.title='Swaven pixel',w.appendChild(t)}function N(e,t){var a,n,r=/<script\b[^>]*>([\s\S]*?)<\/script\s*>/g;t=H(t),Object.keys(t).forEach((function(r){a=new RegExp('{{'+r+'}}','gi'),n=t[r],Array.isArray(n)&&(n=n.join(',')),e=e.replace(a,n)}));for(var o=r.exec(e);o;)P(o[1]),o=r.exec(e);e=e.replace(r,''),w.insertAdjacentHTML('beforeend',e)}function P(e){var t=document.createElement('script');t.setAttribute('type','text/javascript'),t.innerHTML='try {'+e+'} catch(err) {console.error(err);}',w.appendChild(t)}function W(e,t){try{if(!e.event)return void console.error('swntag:event not provided');if(!swnDataLayer.appId)return void console.error('swntag:appId not provided');var a,n=e.event;if(delete e.event,n.indexOf('custom')<0){var r=n;n='swn:'+r,a=function(){try{var t=H(e);switch(r){case'widget_trigger':!function(e){switch(e.action){case'open':window.aweLoader?window.aweLoader.open(e.id,{eans:e.eans||e.product_eans||e.product_ean}):'function'==typeof swnShowLp?swnShowLp(e.widget_container_id):'function'==typeof swnShowWtb&&swnShowWtb(e.widget_container_id,{eans:e.product_ean});break;case'close':window.aweLoader?window.aweLoader.close(e.id):'function'==typeof swnHideLp?swnHideLp(e.widget_container_id):'function'==typeof swnCloseWTB&&swnCloseWTB(e.widget_container_id)}}(t);break;case'transaction':!function(e){if(!e.cart)return void console.error('swntag:transaction, cart not provided');if(!e.cart.orderid)return void console.error('swntag:transaction, orderid not provided');if(!(e.cart.items&&e.cart.items.length>0))return void console.error('swntag:transaction, items missing');var t,a;for(t=0;t<e.cart.items.length;t++){if(!(a=e.cart.items[t]).qt)return void console.error('swntag:transaction, qt missing for item '+t);if(!a.amountincltaxes)return void console.error('swntag:transaction amountincltaxes missing for item '+t)}var n='https://trk-convert.swaven.com/app/'+swnDataLayer.appId+'/transaction?v='+Date.now();Object.keys(e.cart).forEach((function(t){if(Array.isArray(e.cart[t]))for(var a=0;a<e.cart[t].length;a++)Object.keys(e.cart[t][a]).forEach((function(r){n+='&cart['+t+']['+a+']['+r+']='+e.cart[t][a][r]}));else n+='&cart['+t+']='+e.cart[t]}));var r=document.createElement('img');r.src=n,r.style.display='none',r.title='Swaven pixel',w.appendChild(r)}(t);break;case'view_product':te(t,{eans:t.product_ean||t.product_eans,range:t.product_range}),B(r,t);break;default:B(r,t)}}catch(e){console.error(e)}}}pe(n,e,t,a)}catch(e){A(e)}}function M(e){var t={};return Object.keys(e).forEach((function(a){t[a]=e[a]})),t}function H(e,t){e=e?M(e):{};for(var a=[l,swnDataLayer],n=0;n<a.length;n++){var r=a[n];Object.keys(r).forEach((function(t){-1!==u.indexOf(t)||null!==e[t]&&void 0!==e[t]||(e[t]=r[t])}))}return d&&Object.keys(d).forEach((function(t){e['s_'+t]=d[t]})),t&&(Array.isArray(t)||(t=[t]),Object.keys(e).forEach((function(a){t.some((function(e){return e.test(a)}))||delete e[a]}))),e}function J(e){e&&Object.keys(e).forEach((function(t){-1===u.indexOf(t)&&(swnDataLayer[t]=ye(e[t]),A('swntag:set dataLayer '+t+'='+swnDataLayer[t]))}))}function G(e){try{(e=H(e)).widget_buttons||(e.widget_buttons='.swn-tag-wtb-btn');var t=!0;if('true'!==e.widget_disabled&&!0!==e.widget_disabled||(A('swntag:widget is disabled'),t=!1),e.widget||(console.error('swntag:widget param not provided'),t=!1),e.wtbid||(console.error('swntag:wtbid not provided'),t=!1),a&&(console.warn('swntag: not supported browser (widget)'),t=!1),t){var n=_e(e);h&&(n.test=!0),'wtb_insite'===e.widget?t=function(e,t){if(!F(t,e.widget_buttons))return A('swntag:widget can\'t be loaded, eans or range not provided'),!1;var a={pageId:l.pageId,session:d},n={params:t,button:e.widget_buttons,trkCallback:z};e.widget_remote_conf_id&&(n.remoteClientConfId=e.widget_remote_conf_id);e.widget_container_id&&(n.id=e.widget_container_id);a.instances=[],a.instances.push(n),p.spa&&(a.instances[0].ajax=!0);return X(a),!0}(e,n):'wtb_insite_extended'===e.widget?t=Q(2,e,n):'wtb_insite_extended_v3'===e.widget?e.abtest&&Math.random()>.5?(A('A/B test is enabled, switch to AWE'),t=Y(e,n)):t=Q(3,e,n):'wtb_awe'===e.widget?t=Y(e,n):(console.error('swntag:unknown widget type '+e.widget),t=!1)}t||($(e.widget_buttons),p.spa&&!v[e.widget_buttons]&&(v[e.widget_buttons]=setInterval((function(){$(e.widget_buttons)}),1e3)))}catch(e){A(e)}}function F(e,t,a){return e.eans||e.range||K(t)||a&&K('#'+a)}function K(e){return!!e&&document.querySelectorAll(e+'[data-eans]:not([data-eans=""]), '+e+'[data-range]:not([data-range=""])').length>0}function $(e){for(var t=document.querySelectorAll(e+':not(.swn-tag-wtb-btn-disabled)'),a=0;a<t.length;a++)t[a].classList.add('swn-tag-wtb-btn-disabled')}var z=function(e){swnDataLayer.widget_callback&&setTimeout((function(){try{swnDataLayer.widget_callback(e)}catch(e){console.error(e),B('widget_callback_error',H(obj))}}),0),pe('widget:'+e.action,e)};function X(e){if('function'!=typeof swnInitWtb)if(b)setTimeout((function(){X(e)}),100);else{b=!0;var t=document,a=t.createElement('script'),n=t.getElementsByTagName('script')[0];a.src='//widgets-wtb.swaven.com/widgets/wtb/script/wtbLoader.js',a.type='text/javascript',a.onload=function(){swnInitWtb(e)},n.parentNode.insertBefore(a,n)}else swnInitWtb(e)}function Q(e,t,a){if(!F(a,t.widget_buttons))return A('swntag:widget can\'t be loaded, eans or range not provided'),!1;var n={pageId:l.pageId,session:d},r={params:a,buttons:t.widget_buttons,trkCallback:z};return t.widget_remote_conf_id&&(r.remoteClientConfId=t.widget_remote_conf_id),t.widget_container_id&&(r.id=t.widget_container_id),n.instances=[],n.instances.push(r),p.spa&&(n.instances[0].ajax=!0),V(e,n),!0}function V(e,t){if('function'!=typeof swnInitLp)if(_)setTimeout((function(){V(e,t)}),100);else{_=!0;var a='//widgets-lp.swaven.com/'+(2==e?'widgets/lp/script':'scripts')+'/lpLoader.js?v='+Date.now(),n=document,r=n.createElement('script'),o=n.getElementsByTagName('script')[0];r.src=a,r.type='text/javascript',r.onload=function(){swnInitLp(t)},o.parentNode.insertBefore(r,o)}else swnInitLp(t)}function Y(e,t){return t.catalog||F(t,e.widget_buttons,e.widget_container_id)?(t.pageId=l.pageId,t.country=e.country,t.countries&&0!=t.countries.length||(t.catalog?t.countries=Object.keys(t.catalog):e.product_is_global?t.countries=e.countries:t.countries=[e.country]),e.template&&(t.template=e.template),t.eans=t.catalog||t.range||t.eans,t.defaultEan=t.catalog_default_ean||t.defaultEan,e.widget_buttons&&(t.btnSelector=e.widget_buttons),(t.locale||t.lang)&&(t.locale=t.locale||t.lang),e.widget_container_id&&(t.containerId=e.widget_container_id),e.widget_remote_conf_id&&(t.remoteClientConfId=e.widget_remote_conf_id),p.spa&&(t.ajaxButton=!0),t.trackingCallback=z,Z(t),!0):(A('swntag:widget can\'t be loaded, eans, range or catalog not provided'),!1)}function Z(e){if('function'!=typeof swnInitAwe)if(L)setTimeout((function(){Z(e)}),100);else{L=!0;var t=document.createElement('script');t.src=i+'/awe/1/loader.js',e&&(t.onload=function(){swnInitAwe(ee(e))}),document.body.appendChild(t),window.aweCallback=z}else e&&swnInitAwe(ee(e))}function ee(e){return e.dnt=!!swnDataLayer.dnt,e.dnt||(e.session=d),e}function te(e,t,n){if(e.availabilityCallback){if(a)return console.warn('swntag: not supported browser (availability)'),void e.availabilityCallback(!1);if(!('function'==typeof window.swnCheckAvailability||window.aweLoader&&aweLoader.isReady))return void 0===n&&(n=10),0===n?void console.warn('cannot find widget availability function'):setTimeout((function(){te(e,t,--n)}),100);'function'==typeof window.swnCheckAvailability?window.swnCheckAvailability(e.widget_container_id,t,e.availabilityCallback):window.aweLoader&&aweLoader.isReady&&aweLoader.getProductAvailability(t.eans,e.availabilityCallback)}}function ae(){var e,t,a,n=document.location.origin;return n||(n=window.location.protocol+'//'+window.location.host),e=n,t=!0,a=E.encode(e),t?encodeURIComponent(a):a}function ne(e){return e&&!h?r:n}function re(e,t,n,r,o){if(t.indexOf('?')<0&&(t+='?'),t+='&h='+ae(),(y.enabled||y.preview)&&(t+='&v='+Date.now()+'&debug=true',y.preview&&(t+='&preview=true')),n=JSON.stringify(n),'application/x-www-form-urlencoded'==r&&(n='d='+encodeURIComponent(n)),a&&document.documentMode<10){var i=new XDomainRequest;i.onload=function(){o(i.responseText,null)},i.onerror=function(){o(null,'an error occured')},i.ontimeout=function(){o(null,'timeout')},i.open(e,t),i.send(n)}else{var c=new XMLHttpRequest;c.onload=function(){if(4===c.readyState){if(200!=c.status)return o(null,'error '+c.status);o(c.responseText)}},c.open(e,t,!0),c.withCredentials=!0,r&&c.setRequestHeader('Content-Type',r),c.send(n)}}function oe(){var e=y.country||p.geoCountry||'FR';if(p.countries&&1===p.countries.length)s=p.countries[0];else if(swnDataLayer.country)s=swnDataLayer.country;else if(s=e,p.countryFallback&&p.countryFallback.length){var t=swnDataLayer.lang||swnDataLayer.locale;if(t){var a=function(e,t,a){var n=/^([a-z]+)/i.exec(t);if(n&&(t=n[1]),t){var r=(t=t.toLowerCase())+'-'+(a=a.toUpperCase());if(e.indexOf(r)>=0)return{code:r,lang:t,country:a};for(var o=0;o<e.length;o++)if(0==e[o].indexOf(t))return{code:e[o],lang:t,country:/-(.*)/.exec(e[o])[1]}}}(p.countryFallback,t,s);a?(swnDataLayer.locale=a.code,s=a.country):A('swntag:unavailable locale ('+t+' / '+s+') is detected')}}'UK'==(s=s.toUpperCase())&&(s='GB'),A('swntag:set target country '+s),(!p.countries||p.countries.indexOf(s)<0)&&A('swntag:country '+s+' is not enabled for app'),swnDataLayer.geoCountry=e,swnDataLayer.country=s}function ie(){A('swntag:app is ready, flush buffers'),swnDataLayer.push=O=W,swnDataLayer.load=U=G,swnDataLayer.eventBuffer&&(S=swnDataLayer.eventBuffer.concat(S)),S.forEach((function(e){O(e)})),swnDataLayer.loadBuffer&&(j=swnDataLayer.loadBuffer.concat(j)),j.forEach((function(e){U(e)})),'complete'===document.readyState?pe('page:load'):document.addEventListener('load',(function(){pe('page:load')})),p.spa&&setInterval((function(){l.url!=document.location.href&&(p.spaHash||l.url.split('#')[0]!=document.location.href.split('#')[0])&&(function(){g=null,l.rfr=l.url,l.url=document.location.href,l.url_pathname=document.location.pathname,l.pageId=C(),'function'==typeof window.swnUnloadAllLP&&swnUnloadAllLP(),'function'==typeof window.swnUnloadAllWTB&&swnUnloadAllWTB(),'function'==typeof aweLoader.startPageChange?aweLoader.startPageChange():'function'==typeof window.swnUnloadAll&&swnUnloadAll(),1===swnDataLayer.product_set_auto&&Object.keys(swnDataLayer).map((function(e){/product\_(?!id|matching_id|url|mpn)/i.test(e)&&delete swnDataLayer[e]})),delete swnDataLayer.widget_disabled,Object.keys(v).forEach((function(e){clearInterval(v[e])})),v={};for(var e=document.querySelectorAll('.swn-tag-wtb-btn-disabled'),t=0;t<e.length;t++)e[t].classList.remove('swn-tag-wtb-btn-disabled')}(),A('swntag:reseting page data'),pe('page:urlchanged',null,null,(function(){ce((function(){O({event:'view_page'})}),!0)})))}),1e3)}function ce(e,t){var a=de({url:document.location.href,canonicalUrl:ue(),dataLayer:H({})});re('GET',ne(!0)+'/app/'+swnDataLayer.appId+'/page/'+encodeURIComponent(a.key),null,null,(function(a,n){try{if(n)console.error('swntag:load page data failed ('+n+')');else if(g=JSON.parse(a)){if(g.catalog){oe();var r=swnDataLayer.product_is_global=!(!g.catalog.eans&&!g.catalog.rangeId);r||(swnDataLayer.product_catalog=g.catalog);var o=r?g.catalog:g.catalog[s];o&&(o.rangeId?(swnDataLayer.product_range=o.rangeId,A('swntag:set product range '+swnDataLayer.product_range)):o.eans&&o.eans.length>0&&(swnDataLayer.product_ean=swnDataLayer.product_eans=null,1==o.eans.length?swnDataLayer.product_ean=o.eans[0]:swnDataLayer.product_eans=o.eans.join(','),A('swntag:set product(s) '+swnDataLayer.product_ean||swnDataLayer.product_eans)),o.defaultEan&&(swnDataLayer.product_default_ean=o.defaultEan),(swnDataLayer.product_range||swnDataLayer.product_eans||swnDataLayer.product_ean)&&(swnDataLayer.product_set_auto=1))}J(g.dataLayer),h&&ve({action:'waw:apppage',appPage:g,country:swnDataLayer.country}),function(){if(p.actions&&p.actions.some((function(e){return'wtb_insite_extended_v3'===e.widget})))return;const e=_e(window.swnDataLayer),t='mm-awe-globals';let a=document.getElementById(t);a||(a=document.createElement('script'),a.type='application/json',a.id=t,document.body.appendChild(a));a.textContent=JSON.stringify(e)}(),t?'function'==typeof aweLoader.endPageChange&&aweLoader.endPageChange():Z()}e&&e()}catch(n){console.error(n)}}))}const se={IGNORED:0,ALL:1,WHITELIST:2,BLACKLIST:3};function de(e){var t=p.spa,a=t&&p.spaHash,n=p.canonicalUrl&&p.canonicalUrl.useCanonicalUrl&&e.canonicalUrl&&!t?e.canonicalUrl:e.url,r=se.IGNORED,o=null;p.canonicalUrl&&(r=p.canonicalUrl.queryString,o=p.canonicalUrl.urlParams);var i=le(n,r,o,a),c={originalUrl:n,canonicalUrl:i.href,host:i.host,path:i.path,hash:i.hash};if(c.key=c.path+(c.hash||''),p.canonicalUrl){if(e.dataLayer&&p.canonicalUrl.key){var s=p.canonicalUrl.key;for(var d in e.dataLayer){var l=new RegExp('{{'+d+'}}','gi'),u=e.dataLayer[d];Array.isArray(u)?u=u.join(','):'url_pathname'===d&&(u=u.replace(/\/$/,'')),s=s.replace(l,u)}s&&s!=p.canonicalUrl.key&&(c.key=s)}if(p.canonicalUrl.regex)for(var w=0;w<p.canonicalUrl.regex.length;w++){var g=(l=new RegExp(p.canonicalUrl.regex[w],'i')).exec(c.key);if(g&&g.length>1){c.key=g.splice(1).join('_');break}}p.canonicalUrl.useHost&&(c.key.startsWith('/')||(c.key='/'+c.key),c.key=c.host+c.key)}return e.context&&(c.key=e.context+'|'+c.key),c.key=c.key.toLowerCase(),c}function le(e,t,a,n){var r=function(e,t){const a=document.createElement('a');a.href=e;var n=null;if(a.search)if(t){n={};for(var r=a.search.slice(1).split('&'),o=0;o<r.length;o++){var i=r[o].split('=');n[decodeURIComponent(i[0])]=decodeURIComponent(i[1])}}else n=a.search.slice(1);return{href:a.href,protocol:a.protocol,host:a.host,hostname:a.hostname,port:a.port,pathname:a.pathname,path:a.pathname+a.search,search:a.search,query:n,hash:a.hash}}(e,!0);if(r.hash)if(n){var o=le('/'+r.hash.slice(1),t,a,!1);r.hash='#'+o.path.slice(1)}else r.hash='';if(r.pathname&&'/'!=r.pathname&&(r.pathname=r.pathname.replace(/\/$/,'')),t==se.IGNORED)r.query={};else{var i=['/^utm_/i','/^eaf-/i','/^cm_/i','/clid$/i'];t!=se.ALL&&t!=se.BLACKLIST||(t=se.BLACKLIST,a=a?a.concat(i):i);var c={};if(a&&a.length>0)for(var s in r.query){var d=a.some((function(e){var t=/\/(.+)\/(.*)/i.exec(e);return(t?new RegExp(t[1],t.length>1?t[2]:''):new RegExp('^'+e.toLowerCase().trim()+'$','i')).test(s.trim())}));(!d&&t==se.BLACKLIST||d&&t==se.WHITELIST)&&(c[s]=r.query[s])}r.query={},Object.keys(c).sort().forEach((function(e){r.query[e]=c[e]}))}return r.query=function(e,t){return Object.keys(e).map((function(a){return t?encodeURIComponent(a)+'='+encodeURIComponent(e[a]):a+'='+e[a]})).join('&')}(r.query,!0),r.search=r.query?'?'+r.query:'',r.path=r.pathname+r.search,r.href=r.protocol+'//'+r.host+r.path+r.hash,r}function ue(){var e=document.querySelector('link[rel="canonical"]');if(e)return e.href}function we(e,t){var a=de(e);re('POST',n+'/app/'+swnDataLayer.appId+'/page/'+encodeURIComponent(a.key)+'/discover',e,'application/x-www-form-urlencoded',t)}function pe(e,t,a,n){setTimeout((function(){try{if(A('swntag:dispatch event '+e),(a=a||[]).indexOf(e)>=0)return void A('swntag:stop event propagation, event '+e+' has been already triggered in same thread');if(a.push(e),p.triggers&&p.triggers.length>0){var r=p.triggers.slice(0),o=function(){if(r.length>0){var i=r.shift();try{!function(e,t,a){a=H(a);var n,r=!1;if(e.event===t&&(r=!0,e.conditions))for(var o=0;o<e.conditions.length;o++)if(!fe(a,ye((n=e.conditions[o]).variable),n.operator,n.value)){r=!1;break}return r}(i,e)?o():function(e,t,a,n){A('swntag:fire trigger '+e.name),t=t||{};var r=function(){try{if(e.data&&(t=M(t),Object.keys(e.data).forEach((function(a){t[a]=ye(e.data[a]),A('swntag:set trigger context data '+a+'='+t[a])}))),e.actions)for(var r,o=0;o<e.actions.length;o++){var i=M(t);A('swntag:exec action '+(r=e.actions[o]).type+' '+r.name);try{switch(r.type){case'tag':N(r.tag,i);break;case'custom_event':i.event='custom:'+r.event,O(i,a);break;case'event':i.event=r.event,O(i,a);break;case'widget':r.wtbid&&(i.wtbid=r.wtbid),r.remoteClientConfId&&(i.widget_remote_conf_id=r.remoteClientConfId),r.containerId&&(i.widget_container_id=r.containerId),r.btnSelector&&(i.widget_buttons=r.btnSelector),i.abtest=r.abtest,i.widget=r.widget,U(i);break;default:A('swntag:'+variable.type+' variable is not implemented')}}catch(e){console.error('swntag:fire '+r.name+' failed: '+e)}}}catch(e){console.error(e)}finally{ge(n)}};e.dataLayer&&('country'in e.dataLayer&&console.warn('swntag:setting country in datalayer at trigger level shouldn\'t be done'),J(e.dataLayer));var o=swnDataLayer.product_ean||swnDataLayer.product_eans||swnDataLayer.product_range||t&&(t.product_ean||t.product_eans||t.product_range);e.productAuto&&o&&A('swntag: product data context is already set, product auto discovery is ignored');!o&&e.productAuto?function(e){swnDataLayer.product_set_auto=1;var t={url:document.location.href,canonicalUrl:ue(),dataLayer:H({},[/country/,/locale/,/product\_/i]),content:{title:document.title}};t.dataLayer&&t.dataLayer.product_urls&&t.dataLayer.product_urls.length&&(t.dataLayer.product_urls_keys=t.dataLayer.product_urls.map((function(e){return de({url:e}).key}))),we(t,(function(t,a){try{if(a)console.error('swntag:discover product failed ('+a+')');else{var n=be(t);if(n)if(n.rangeId)swnDataLayer.product_range=n.rangeId;else if(n.prds&&n.prds.length>0){if(swnDataLayer.product_ean=swnDataLayer.product_eans=null,1==n.prds.length){var r=n.prds[0];swnDataLayer.product_ean=r.ean,swnDataLayer.product_label=r.label,swnDataLayer.product_label2=r.label2,swnDataLayer.product_containing=r.containing,swnDataLayer.product_image=r.img,swnDataLayer.product_brand=r.brand,A('swntag:set product '+swnDataLayer.product_ean+'-'+swnDataLayer.product_label)}else{var o=n.prds.map((function(e){return e.ean}));swnDataLayer.product_eans=o.join(','),A('swntag:set products '+swnDataLayer.product_eans)}h&&ve({action:'waw:getEans',eans:swnDataLayer.product_eans||swnDataLayer.product_ean})}}e&&e()}catch(a){console.error(a)}}))}(r):r()}(i,t,a,o)}catch(e){A('swntag:eval or fire trigger failed '+e),o()}}else ge(n)};o()}else ge(n)}catch(e){console.error(e)}}),0)}function ge(e){try{e&&e()}catch(e){console.error(e)}}function fe(e,t,a,n){var r=!1,o=!1;try{var i=/not\_(.+)/i.exec(a);switch(i&&(r=!0,a=i[1]),a){case'equals':o='string'==typeof t&&'string'==typeof n?new RegExp(n,'i').test(t):!(null!=t&&''!==t||null!=n&&''!==n)||t==n;break;case'contains':o=!!t&&t.indexOf(n)>=0;break;case'starts_with':o=!!t&&0===t.indexOf(n);break;case'ends_with':o=!!t&&t.lastIndexOf(n)===t.length-n.length;break;case'matches':o=new RegExp(n).test(null===t?'':t);break;case'matches_ignorecase':o=new RegExp(n,'i').test(null===t?'':t);break;default:console.error('operator '+a+' not implemented')}}catch(e){console.error(e)}return r?!o:o}function ye(e){var t=null;try{if('object'!=typeof e){if('string'==typeof e)for(var a,n=[{regex:/(url:.+)/i},{regex:/(dataLayer):(.+)/i,k:'key'},{regex:/(cookie):(.+)/i,k:'cookie'}],r=0;r<n.length;r++){var o=n[r];if(s=o.regex.exec(e)){e={type:s[1]},o.k&&(e[o.k]=s[2]),a=!0;break}}if(!a)return e}var i=e.type.toLowerCase();if('dom'===i){if(e.selector){var c=document.querySelector(e.selector);c&&(t=e.attribute?c.getAttribute(e.attribute):c.innerText)}}else if('script'===i)t=new Function(e.script)();else if('cookie'===i)t=T(e.cookie);else if(0==i.indexOf('url:')){(s=/url:(.+)/i.exec(e.type))&&(t=document.location[s[1]])}else{if('datalayer'!==i)throw e.type+' variable is not implemented';t=swnDataLayer[e.key]}if(t&&e.regex){var s,d=new RegExp(e.regex,'ig');if(e.regexReplacePattern)t=t.replace(d,e.regexReplacePattern);else(s=d.exec(t))&&(t=s[1])}}catch(e){console.error(e),t=null}return t}function he(a){if(a){if(a.source!==e||(n=k,r=a.origin,n!==r&&n.replace(/-(stg|dev)/,'')!==r.replace(/-(stg|dev)/,'')))return console.warn('Ignoring postMessage from unauthorized origin/source '+a.origin);var n,r;if(void 0===t&&(t=a.origin),a.data){var o=null,i=be(a.data);switch(i.action){case'waw:ready':m=!0,D.forEach((function(e){ve(e)})),D.length=0;break;case'waw:getSessionParams':o={action:i.action,data:y};break;case'waw:setSessionParams':y=i.debug,R(),o={action:i.action};break;case'waw:getSuggestions':break;case'waw:getEans':var c=swnDataLayer.product_eans||swnDataLayer.product_ean;c&&ve({action:i.action,eans:c})}null!=o&&a.source.postMessage(o,a.origin)}}}function me(e){if(e.source==window&&e.data&&e.data.action&&'swaven-tag-extension'==e.data.source)switch(e.data.action){case'tam:isAdmin':window.postMessage({source:'swaven-tag',action:e.data.action,admin:h},'*');break;case'tam:setAdmin':h=!0,R(),location.reload();break;case'tam:quitAdmin':document.cookie='swnAdminParams=; expires=Thu, 01 Jan 1970 00:00:00 GMT; path=/';var t=location.href.replace(/&?swntagadmin=(1|true)/i,'');t===location.href?location.reload():location.href=t}}function ve(a){h&&(m?e.postMessage(a,t||'*'):D.push(a))}function be(e){if('string'!=typeof e)return e;try{return JSON.parse(e)}catch(t){return e}}function _e(e){var t={},a=new RegExp(/^widget_/);return e.wtbid&&(t.wtbid=e.wtbid),e.product_catalog&&Object.keys(e.product_catalog).forEach((function(a){if(e.product_catalog[a]){var n=e.product_catalog[a].rangeId||e.product_catalog[a].eans,r=e.product_catalog[a].defaultEan;n&&(!Array.isArray(n)||n.length>0)&&(t.catalog||(t.catalog={}),t.catalog[a]=n),r&&(t.catalog_default_ean||(t.catalog_default_ean={}),t.catalog_default_ean[a]=r)}})),(e.product_ean||e.product_eans)&&(t.eans=e.product_ean||e.product_eans),e.product_range&&(t.range=e.product_range),e.product_default_ean&&(t.defaultEan=t.defaultPrd=e.product_default_ean),(e.locale||e.lang)&&(t.lang=e.locale||e.lang,'awe'==e.widget_type&&(t.locale=t.lang)),t.appid=swnDataLayer.appId,t.dntDefault=swnDataLayer.dntDefault,Object.keys(e).forEach((function(n){a.test(n)&&(t[n.replace(a,'')]=e[n])})),delete t.buttons,delete t.container_id,t}swnDataLayer.discover=function(e,t){if((e=Object.assign({dataLayer:{}},e)).dataLayer.country=swnDataLayer.country,e.dataLayer.locale=swnDataLayer.locale,!e.url)throw'discovery key url is missing';if(!e.context)throw'discovery context is missing';we(e,(function(e,a){try{var n={};if(a)console.error('swntag:discover product failed ('+a+')');else{var r=be(e);if(r)if(r.rangeId)n.product_range=r.rangeId;else if(r.prds&&r.prds.length>0){var o=r.prds.map((function(e){return e.ean}));n.product_eans=o.join(',')}}t&&t(n)}catch(a){console.error(a)}}))},swnDataLayer.setDNT=function(e){var t;swnDataLayer.dnt=!!e;try{swnDataLayer.dnt?sessionStorage.removeItem(c):(!function(){for(;I.length>0;)q(I.shift())}(),sessionStorage.setItem(c,JSON.stringify(d)),t=d),window.aweLoader&&aweLoader.setDNT(swnDataLayer.dnt,t)}catch(e){console.error(e)}};try{O({event:'view_page'}),swnDataLayer.appId?(A('swntag:load app '+swnDataLayer.appId),swnDataLayer.locale||swnDataLayer.lang||!document.documentElement.lang||(swnDataLayer.locale=document.documentElement.lang),function(){try{var e;swnDataLayer.dnt||(e=sessionStorage.getItem(c)),d=e?JSON.parse(e):{id:C(),ts:Date.now(),referrer:document.referrer?document.referrer.substring(0,512):null,url:document.location.href?document.location.href.substring(0,512):null},!swnDataLayer.dnt&&d&&sessionStorage.setItem(c,JSON.stringify(d)),localStorage.removeItem(c)}catch(e){console.error(e)}}(),re('GET',ne(!0)+'/app/'+swnDataLayer.appId,null,null,(function(t,a){try{if(a)return void console.error('swntag:failed getting app ('+a+')');p=be(t),y.preview&&!p.preview&&console.warn('swntag:preview app requested but not found'),function(){A('swntag:start app'),p.actions&&p.triggers&&p.actions.forEach((function(e){if(e.triggers)var t,a,n;for(t=0;t<e.triggers.length;t++)for(a=0;a<p.triggers.length;a++)if((n=p.triggers[a])._id===e.triggers[t]){n.actions||(n.actions=[]),n.actions.push(e);break}})),p.actions&&p.actions.some((function(e){return'widget'==e.type&&'wtb_awe'===e.widget}))&&Z(),swnDataLayer.countries=p.countries,swnDataLayer.geoCountry=y.country||p.geoCountry,p.dataLayer&&J(p.dataLayer),oe();var e=function(e){try{(document.body||document.getElementsByTagName('body')[0]).appendChild(w),ce((function(){try{pe('page:ready',null,null,ie)}catch(e){console.error(e)}}),!1)}catch(e){console.error(e)}};'loading'===document.readyState?document.addEventListener('DOMContentLoaded',e):e()}(),window.addEventListener('message',me,!1),h&&(function(){var t=document.createElement('script');t.src=k+'/admin/loader/loader.js',t.async=!0,(document.body||document.getElementsByTagName('body')[0]).appendChild(t),window.addEventListener('message',he,!1);var a=setInterval((function(){var t=document.getElementById('swn-admin-widget');t&&(e=t.contentWindow,clearInterval(a))}),10)}(),ve({action:'waw:app',app:p,country:swnDataLayer.country}))}catch(a){console.error(a)}}))):console.error('appId not provided')}catch(e){console.error(e)}swnDataLayer.dnt||sessionStorage.setItem(c,JSON.stringify(d))}();
//# sourceMappingURL=tag.min.js.map