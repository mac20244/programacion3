'use strict';Vue.component('awe-product-slider',{props:{currentProductEan:{type:String},products:{type:Array,default:function(){return[]}},defaultEan:{type:String},slideDuration:{type:Number,default:600},slideInterval:{type:Number,default:0},noSiblings:{type:Boolean,default:!0},pagination:{type:Boolean,default:!1}},data:function(){return{_products:[],productIdx:-1,scrollStep:0,scrollOffset:0,positionOffset:0,ready:!1,siblingsIdx:[],paginationRequested:!1,transitionDuration:0,autoSlideItvId:null,pdtWidth:0,transitionInProgress:!1,upateProductsOnTransition:!1,_delayedSlideWip:!1,resizeObs:null,i18n:window.i18n}},computed:{ctnrStyle:function(){const t={transform:`translateX(${this.scrollOffset}px)`,left:this.positionOffset+'px',transition:this.ready?`transform ${this.transitionDuration}ms`:'none'};return this._noSiblings&&(t.width=100*(this.$data._products?this.$data._products.length:1)+'%'),t},pdtStyle:function(){return this.noSiblings?{}:{width:`${this.pdtWidth.toFixed(1)}px`}},_noSiblings:function(){return!this.$data._products||(this.$data._products.length<=2||this.noSiblings)},hideSlideButtons:function(){return!this.$data._products||this.$data._products.length<2},currentLabel:function(){if(-1===this.productIdx)return'';{let t=this.$data._products[this.productIdx];if(!t)return'';let i=t.name;return t.pkg&&(i+=' - '+t.pkg),i}},previousLabel:function(){let t;if(-1!==this.productIdx)return t=this.productIdx>0?this.productIdx-1:this.$data._products.length-1,this.$data._products[t]&&`${this.$data._products[t].name} ${this.$data._products[t].pkg}`||''},nextLabel:function(){let t;if(-1!==this.productIdx)return t=this.productIdx<this.$data._products.length-1?this.productIdx+1:0,this.$data._products[t]&&`${this.$data._products[t].name} ${this.$data._products[t].pkg}`||''}},watch:{products:{handler(t){this.paginationRequested=!1,this.pagination&&this.transitionInProgress?this.upateProductsOnTransition=!0:this.$data._products=t},immediate:!0},'$data._products':function(t,i){let e=!0;t&&i&&t.length!==i.length&&(this.resetNodeList(),this.updateSiblings(!1),e=!1);let s=0;for(;e&&s<t.length;)t[s]&&i[s]&&t[s].id===i[s].id||(e=!1),s++;e||(this.init(),this.attachObserver())},defaultEan:function(){this.init()},productIdx:function(t,i){this.updateSiblings(-1===i)}},created:function(){window.ResizeObserver&&(this.resizeObs=new ResizeObserver((t=>{for(let i=0;i<t.length;i++){const e=t[i];e.target.classList.contains('ctnr')?(this.pdtWidth=e.contentRect.width/3,this.scrollStep=e.contentRect.width/3):e.target.classList.contains('pdt')&&(this.pdtWidth=e.contentRect.width,this.scrollStep=e.contentRect.width)}})))},mounted:function(){if(this.transitionDuration=this.slideDuration,this.slideInterval&&(this.autoSlideItvId=setInterval((()=>{this.$data._products&&this.$data._products.length<2||this.select(1,!0)}),Math.abs(this.slideInterval))),this.attachObserver(),this.pagination){const t=this.$el.getElementsByClassName('content')[0];t.addEventListener('transitionstart',(t=>{t.target===t.currentTarget&&'transform'===t.propertyName&&(this.transitionInProgress=!0)})),t.addEventListener('transitionend',(t=>{t.target===t.currentTarget&&'transform'===t.propertyName&&(this.transitionInProgress=!1,this.upateProductsOnTransition&&(this.$data._products=this.products,this.upateProductsOnTransition=!1))}))}this.init()},updated:async function(){if(window.ResizeObserver||this.noSiblings)return;await this.$nextTick();const t=this.$el.getElementsByClassName('ctnr')[0].getBoundingClientRect().width,i=this.$el.getElementsByClassName('content')[0],e=i.getBoundingClientRect().width;this.pdtWidth!==t/3&&(this.pdtWidth=t/3),e===t&&(i.style.width=(this.pdtWidth*this.$data._products.length).toFixed(1)+'px')},methods:{init:async function(){if(this.ready=!1,!this.$data._products||!this.$data._products.length)return;const t=this.currentProductEan||this.defaultEan;t?this.productIdx=this.$data._products.findIndex((i=>i.ean&&i.ean===t||i.eans&&i.eans.includes(t))):-1===this.productIdx&&(this.productIdx=0),await this.$nextTick();const i=this.$el.getElementsByClassName('ctnr')[0].getBoundingClientRect().width;this.noSiblings||(this.pdtWidth=i/3),await this.$nextTick();const e=this.$el.getElementsByClassName('content')[0].getBoundingClientRect().width;this.scrollStep=this.$el.querySelector('.pdt').getBoundingClientRect().width;let s=0;this.$data._products.length%2==0&&(s=this.scrollStep/2),this.reorderNodes(),this.scrollOffset=-e/2+s,this.positionOffset=i/2,setTimeout((()=>{this.ready=!0}),100);const n=this.$el.getElementsByClassName('pdt');for(let t of n){t.style.transition=`opacity ${this.transitionDuration}ms`;for(let i of t.children)i.style.transition=`transform ${this.transitionDuration}ms`}},attachObserver:function(){this.resizeObs&&(this.resizeObs.disconnect(),this._noSiblings?this._noSiblings&&this.$nextTick().then((()=>{const t=this.$el.getElementsByClassName('pdt')[0];t&&this.resizeObs.observe(t)})):this.resizeObs.observe(this.$el.getElementsByClassName('ctnr')[0]))},reorderNodes:function(){let t=-1;const i=this.$el.getElementsByClassName('pdt'),e=this.productIdx.toString();for(let s=0;s<i.length;s++)if(i[s].dataset.idx===e){t=s;break}if(-1===t)return void console.error('Cannot find selected product in node list.');const s=t-(Math.ceil(this.$data._products.length/2)-1),n=this.$el.getElementsByClassName('content')[0];for(let t=0;t<Math.abs(s);t++)s>0?n.appendChild(n.firstElementChild):n.insertBefore(n.lastElementChild,n.firstElementChild)},resetNodeList:function(){const t=this.$el.getElementsByClassName('content')[0],i=[];for(;t.children.length>0;){const e=t.children[0];i.push(t.removeChild(e))}i.sort(((t,i)=>{const e=parseInt(t.dataset.idx,10),s=parseInt(i.dataset.idx,10);return e<s?-1:e>s?1:0}));for(let e=0;e<i.length;e++)t.appendChild(i[e])},updateSiblings:async function(t){const i=this.$el.getElementsByClassName('sibling');for(let t=0;t<i.length;t++)i[t].removeEventListener('click',this.siblingClickHandler);this.$data._products.length>1?this.siblingsIdx=[(this.productIdx+1)%this.$data._products.length,this.productIdx-1>=0?this.productIdx-1:this.$data._products.length-1]:this.siblingsIdx=[],t&&await this.$nextTick();const e=this.$el.querySelectorAll(`.pdt[data-idx="${this.siblingsIdx[0]}"], .pdt[data-idx="${this.siblingsIdx[1]}"]`);for(let t of e)t.addEventListener('click',this.siblingClickHandler)},select:function(t,i=!1){if(!t||this.$data._delayedSlideWip)return;this.autoSlideItvId&&!i&&clearInterval(this.autoSlideItvId);let e=(this.productIdx+t)%this.$data._products.length;e<0&&(e=this.$data._products.length-1),this.scrollOffset+=this.scrollStep*-t,this._noSiblings?this.simpleSlide(t):this.slideWithSiblings(t),this.productIdx=e,this.$emit('product-select',this.$data._products[this.productIdx]),this.pagination&&!this.paginationRequested&&this.productIdx>=this.$data._products.length-4&&(this.$emit('pagination-request'),this.paginationRequested=!0)},siblingClickHandler:function(t){const i=parseInt(t.currentTarget.dataset.idx,10);let e=0;e=0===this.productIdx?i===this.productIdx+1?1:-1:this.productIdx===this.$data._products.length-1?0===i?1:-1:i>this.productIdx?1:-1,this.select(e)},simpleSlide:function(t){const i=this.$el.getElementsByClassName('content')[0];i&&(t>0?this.$data._products.length>2&&i.appendChild(i.firstElementChild):i.insertBefore(i.lastElementChild,i.firstElementChild),t>0&&this.$data._products.length<=2?setTimeout((()=>{i.appendChild(i.firstElementChild),this.positionOffset+=this.scrollStep*t}),this.transitionDuration):this.positionOffset+=this.scrollStep*t)},slideWithSiblings:function(t){t>0&&this.$data._products.length<=4?setTimeout((()=>{this.positionOffset+=this.scrollStep*t}),this.transitionDuration):this.positionOffset+=this.scrollStep*t;const i=this.$el.getElementsByClassName('content')[0];if(t>0)if(this.$data._products.length>4)i.appendChild(i.firstElementChild);else if(4===this.$data._products.length)setTimeout((()=>{i.appendChild(i.firstElementChild)}),this.transitionDuration);else{this.$data._delayedSlideWip=!0;const t=i.querySelector(`[data-idx="${this.productIdx}"]`).previousElementSibling,e=t.cloneNode(!0);i.appendChild(e),t.style.opacity=0,setTimeout((()=>{i.removeChild(e),t.style.opacity='',i.appendChild(i.firstElementChild),this.$data._delayedSlideWip=!1}),this.transitionDuration)}else if(t<0&&3===this.$data._products.length){this.$data._delayedSlideWip=!0;const t=i.querySelector(`[data-idx="${this.productIdx}"]`).nextElementSibling,e=t.cloneNode(!0);i.insertBefore(e,i.firstElementChild),t.style.opacity=0,setTimeout((()=>{i.removeChild(e),t.style.opacity='',i.insertBefore(t,i.firstElementChild),this.$data._delayedSlideWip=!1}),this.transitionDuration)}else i.insertBefore(i.lastElementChild,i.firstElementChild)},swipeStart:function(t){this.$data._products.length<2||(this._swipeStart=t.touches[0].screenX,this._offsetBeforeSwipe=this.scrollOffset,this.transitionDuration=0,this.$el.addEventListener('touchmove',this.previewMove))},swipe:function(t){if(this.$data._products.length<2)return;this.transitionDuration=this.slideDuration,this.scrollOffset=this._offsetBeforeSwipe;const i=Math.sign(this._swipeStart-t.changedTouches[0].screenX);this.select(i),this.$el.removeEventListener('touchmove',this.previewMove)},previewMove:function(t){let i=this._swipeStart-t.touches[0].screenX;const e=i>0?1:-1;Math.abs(i)>this.scrollStep&&(i=(this.scrollStep+.2*(Math.abs(i)-this.scrollStep))*e),this.scrollOffset=this._offsetBeforeSwipe-i},arrowNav:function(t){const i='ArrowLeft'===t.key?-1:1;this.select(i)}},template:'\n    <div class="product-slider" v-on:touchstart.stop.passive="swipeStart"\n        v-on:touchend.stop.passive="swipe" :class="{\'no-sibling\': _noSiblings}"\n        :aria-label="i18n.getString(\'PRODUCT_SLIDER_LBL\')" :tabindex="$data._products.length > 1 ? \'0\' : \'\'"\n        v-on:keydown.self.stop.passive.left.right="arrowNav"\n        role="listbox" :aria-activedescendant="\'pdt_\'+ productIdx"\n        aria-orientation="horizontal">\n\n      <div v-on:click.stop.passive="select(-1)" v-on:keypress.stop.passive.enter="select(-1)"\n          class="slide-btn left" :class="{disabled: hideSlideButtons || pagination && productIdx === 0}"\n          tabindex="0" role="button" :aria-label="i18n.getString(\'SELECT_PREVIOUS_PRODUCT\', \'name\', previousLabel)">\n        <div class="picto" role="presentation"></div>\n      </div>\n\n      <div class="ctnr" role="presentation">\n        <div class="content" :style="ctnrStyle" role="presentation">\n          <div v-for="(pdt, i) in $data._products" class="pdt"\n              :id="\'pdt_\' + i"\n              :class="{selected: i === productIdx, sibling: siblingsIdx.includes(i)}"\n              :data-idx="i" :style="pdtStyle"\n              :aria-label="i === productIdx ? pdt.name + \' \' + pdt.pkg: \'\'"\n              :aria-selected="(i === productIdx).toString()" :aria-current="(i === productIdx).toString()"\n              role="option">\n            <slot v-bind:pdt="pdt" v-bind:i="i">\n            </slot>\n          </div>\n        </div>\n      </div>\n\n      <div v-on:click.stop.passive="select(1)" v-on:keypress.stop.passive.enter="select(1)"\n          class="slide-btn right" :class="{disabled: hideSlideButtons || pagination && productIdx === $data._products.length - 1}"\n          tabindex="0" role="button" :aria-label="i18n.getString(\'SELECT_NEXT_PRODUCT\', \'name\', nextLabel)">\n        <div class="picto" role="presentation"></div>\n      </div>\n\n      <div id="ta-announce" aria-live="polite">{{currentLabel}}</div>\n    </div>\n  '});
//# sourceMappingURL=product-slider.js.map
