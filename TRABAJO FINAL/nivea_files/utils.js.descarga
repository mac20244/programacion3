'use strict';const AVAIL_SORT_ORDER={PRIO_LIST:Symbol.for(-1),DEFAULT:Symbol.for(0),RANDOM:Symbol.for(1),PRICE:Symbol.for(2)},UNITS=[['oz','ounce','ounces'],['kg','kgs'],['g','grm','gm']];class Utils{static getReverseGeocoding(e,t,r=[],n=null,a='',o,s){let i='access_token=pk.eyJ1Ijoic3dhdmVuIiwiYSI6ImNqbTd1dXBlcjFhejMzcHBvajVlYjFjMXcifQ.ljVSrON2CjvnSj38Nxa9RA';return r.length>0&&(i+=`&country=${'string'==typeof r?r:r.join(',')}`),n&&(i+=`&language=${n}`),new Promise((async(r,n)=>{try{const n=await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${e},${t}.json?${i}`),s=await n.json();if(n.status>=400)throw new Error(s.message);0===s.features.length&&r([null,null]),r([null,Utils.parseFeature(s.features[0],a,o)])}catch(e){console.error(e),Tracker.log('error',{msg:e.message,stack:e.stack}),r(['Mapbox reverse geocoding failure'])}})).then((([e,t])=>{if(!s)return Promise.resolve(e?null:t);s(e,t)}))}static queryMapbox(e,t,r,n=5,a){const o=`country=${t.join(',')}&language=${r}&limit=${n}&access_token=pk.eyJ1Ijoic3dhdmVuIiwiYSI6ImNqbTd1dXBlcjFhejMzcHBvajVlYjFjMXcifQ.ljVSrON2CjvnSj38Nxa9RA`;return new Promise((async(t,r)=>{try{const r=await fetch(`https://api.mapbox.com/geocoding/v5/mapbox.places/${e}.json?${o}`);t([null,(await r.json()).features])}catch(e){console.error(e),Tracker.log('error',{msg:e.message,stack:e.stack}),t(['Mapbox query failure'])}})).then((([e,t])=>{if(!a)return e?Promise.reject(e):Promise.resolve(t);a(e,t)}))}static parseFeature(e,t='',r){const n={address:'',city:'',zipCode:'',region:'',country:'',latitude:0,longitude:0,boundingBox:null,source:t,auto:!!r,type:''};if(!e)return n;if(e.place_type.includes('postcode')&&(n.zipCode=e.text),e.place_type.includes('country')&&e.properties.short_code&&(n.country=e.properties.short_code.toUpperCase()),e.context&&e.context.forEach((e=>{switch(e.id.split('.')[0]){case'postcode':n.zipCode||(n.zipCode=e.text);break;case'place':n.city=e.text;break;case'region':e.short_code&&(n.region=e.short_code.toUpperCase(),n.country||(n.country=n.region));break;case'country':e.short_code&&(n.country=e.short_code.toUpperCase())}})),!n.city&&e.place_type.includes('place')&&(n.city=e.text),n.longitude=e.center[0],n.latitude=e.center[1],n.address=e.place_name,e.place_type&&e.place_type.length>0&&(n.type=e.place_type[0]),'region'===n.type&&e.properties.short_code&&(n.region=e.properties.short_code.toUpperCase()),e.bbox&&(n.boundingBox=e.bbox),'country'===n.type){const e=Utils.rewriteBoundingBox(n.country);e&&(n.boundingBox=e)}return n.region&&n.country&&(n.region=n.region.replace(new RegExp(`^${n.country}-`,'i'),'')),n}static rewriteBoundingBox(e){let t;if('FR'===e)t=[-5.238938,41.362375,9.9561494,51.184074];return t}static getHaversineDistance(e,t){const r=Utils._toRadians(e.longitude||e.lng||e[0]||0),n=Utils._toRadians(e.latitude||e.lat||e[1]||0),a=Utils._toRadians(t.longitude||t.lng||t[0]||0),o=Utils._toRadians(t.latitude||t.lat||t[1]||0),s=Math.sin((o-n)/2)**2,i=Math.sin((a-r)/2)**2,c=Math.min(s+i*Math.cos(n)*Math.cos(o),1);return 12742e3*Math.asin(Math.sqrt(c))}static _toRadians(e){return e*Math.PI/180}static uuid(e){return e?(e^16*Math.random()>>e/4).toString(16):([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,Utils.uuid)}static changeAWSEndpoint(e,t){return t?e.replace('{{region}}',t):e.replace('{{region}}-','')}static clone(e,t=!1){if(!e)return e;var r=e instanceof Array?[]:{};for(let n in e)e[n]&&'object'==typeof e[n]?r[n]=Utils.clone(e[n],t):'function'==typeof e[n]&&t||(r[n]=e[n]);return r}static removeHTML(e){let t=e;return'string'==typeof e&&(t=e.replace(/\<br\s*\/?\>/gi,' ').replace(/\<[^\>]*\>/g,'').replace(/\s{2,}/g,' ').trim()),t}static sanitizeProduct(e){if(!e)return e;var t=['name','brand','description','pkg','label','listLabel'];for(let r=0;r<t.length;r++){let n=t[r];e[n]&&(e[n]=e[n].replace(/\n/g,'<br>').replace(/{{pbr}}/g,e.brand||'').replace(/{{pname}}/g,e.name||'').replace(/{{pname2}}/g,e.name2||'').replace(/{{ppckg}}/g,e.pkg||'').replace(/{{pdescr}}/g,e.description||'').replace(/{{br}}/g,'<br>').replace(/{{strong}}/g,'<strong>').replace(/{{endStrong}}/g,'</strong>').replace(/{{seemore}}/g,'<seemore>').replace(/<\/?script[^>]*>/gi,''))}return e}static toCamelCase(e){return(e=e||'').toLowerCase().replace(/-+(.)/g,((e,t)=>t.toUpperCase())).replace(/-+$/,'')}static setTrackingHost(e,t){const r={BT:'https://trk2-bt.swaven.com',VT:'https://trk2-vt.swaven.com',WTB:'https://trk2-wtb.swaven.com'}[e];return Utils.changeAWSEndpoint(r,t)}static arraysEqual(e,t){if(null==e||null==t)return e==t;if(e.length!==t.length)return!1;let r=!0;for(let n=0;n<e.length;n++)if(e[n]!==t[n]){r=!1;break}return r}static countStoresInArea(e,t){const r=e[0],n=e[1],a=e[2],o=e[3];return t.reduce(((e,t)=>n<=t.store.location.latitude&&t.store.location.latitude<=o&&r<=t.store.location.longitude&&t.store.location.longitude<=a?e+1:e),0)}static prependColor(e){return e&&/^([0-9a-f]{3}){1,2}$/i.test(e)?'#'+e:e}static alphanumericSort(e,t){const r=/(\d+)|([^\d]+)/g,n=e.match(r),a=t.match(r);for(let e=0;e<n.length;e++){const t=n[e],r=a[e];if(!r)return 1;const o=parseInt(t,10),s=parseInt(r,10);if(isNaN(o)&&isNaN(s)){if(t<r)return-1;if(t>r)return 1}else{if(isNaN(o)&&!isNaN(s))return 1;if(!isNaN(o)&&isNaN(s))return-1;if(o<s)return-1;if(o>s)return 1}}return 0}static compareAvails(e,t,r,n){const a=e.store.brick||e.store.collect||e.store.drive,o=t.store.brick||t.store.collect||t.store.drive;return a&&!o?1:o&&!a?-1:a&&o?e.store.distance-t.store.distance:Utils.compareOnline(e,t,r,n)}static compareOnline(e,t,r,n){if(r===AVAIL_SORT_ORDER.PRICE)return e.price.amount-t.price.amount;if(r===AVAIL_SORT_ORDER.RANDOM)return Math.random()-.5;if(r===AVAIL_SORT_ORDER.PRIO_LIST){if(!n)throw new Error('Missing retailer priority list');const r=n.indexOf(e.retailer.id),a=n.indexOf(t.retailer.id);return-1===r&&a>-1?1:r>-1&&-1===a?-1:r===a?e.retailer.name===t.retailer.name?e.price.amount-t.price.amount:e.retailer.name<t.retailer.name?-1:(e.retailer.name,t.retailer.name,1):r-a}return e.retailer.name<t.retailer.name?-1:e.retailer.name>t.retailer.name?1:void 0}static mergeAvailLists(e,t,r,n){let a=0,o=0,s=[...e];for(;a<s.length&&o<t.length;){const e=Utils.compareAvails(s[a],t[o],r,n);if(e>=0){const r=+(0===e);s.splice(a+r,0,t[o]),o++,r&&a++}a++}return o<t.length&&(s=[...s,...t.slice(o)]),s}static getPerf(e){const t=performance.getEntriesByName(e,'measure')[0];return t?Math.round(t.duration):-1}static getQueryStringParam(e,t){try{return decodeURIComponent(e.split('?')[1].split('&').filter((e=>e.startsWith(t+'=')))[0].substring(t.length+1))}catch(e){return''}}static toHSL(e){e.length<6&&(e=e.replace(/(\w)/g,'$1$1'));let t=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(e),r=parseInt(t[1],16),n=parseInt(t[2],16),a=parseInt(t[3],16);r/=255,n/=255,a/=255;let o,s,i=Math.max(r,n,a),c=Math.min(r,n,a),l=(i+c)/2;if(i==c)o=s=0;else{let e=i-c;switch(s=l>.5?e/(2-i-c):e/(i+c),i){case r:o=(n-a)/e+(n<a?6:0);break;case n:o=(a-r)/e+2;break;case a:o=(r-n)/e+4}o/=6}return s*=100,s=Math.round(s),l*=100,l=Math.round(l),o=Math.round(360*o),{h:o,s:s,l:l}}static lighten(e,t=15){const r=Utils.toHSL(e);return r.l+=t,r.s-=Math.round(t/2),`hsl(${r.h} ${r.s}% ${r.l}%)`}static darken(e,t=15){const r=Utils.toHSL(e);return r.l-=t,r.s+=Math.round(t/2),`hsl(${r.h} ${r.s}% ${r.l}%)`}static labelAndPkg(e){try{if(!e)return'';if(!e.pkg)return e.name;let t,r,n=e.name;for(let n=0;n<UNITS.length;n++){for(let a=0;a<UNITS[n].length;a++){let o=UNITS[n][a];if(new RegExp(`(?:\\b|\\d)${o}\\b`,'i').test(e.pkg)){t=UNITS[n],r=t[a];break}}if(t)break}if(t){const a=e.pkg.toLowerCase(),o=new RegExp(`\\s*${r}\\b`);t.some((t=>{const r=a.replace(o,`\\s*${t}\\b`);return new RegExp(r,'i').test(e.name)}))||(n+=(n?' ':'')+e.pkg)}else{const t=e.pkg.replace(/([\+\*\?\(\)\[\]])/g,'\\$1').replace(/([^a-z\s\u00a1-\u024f])(?=[a-z])|([a-z])(?=[^a-z\s\u00a1-\u024f])/gi,'$1$2\\s*').replace(/((\\s\*)|\s)+/g,'\\s*');new RegExp(t,'i').test(e.name)||(n+=(n?' ':'')+e.pkg)}return n}catch(t){return console.error(t),e.name}}static getStoreFullname(e){if(!e)return'';let t=[];return e.store.name&&t.push(e.store.name),e.retailer.name&&!e.store.name?.startsWith(e.retailer.name)&&t.unshift(e.retailer.name),t=t.concat([e.store.location.address,e.store.location.city,e.store.location.zipCode]),t.join(' ')}static parseFont(e,t,r,n){if(t&&t.includes('fonts.googleapis')){const n=`@import url('${t}');`,a=Utils.getQueryStringParam(t,'family');r.push({fontName:a,rule:n,optionName:e})}else if(t){const r=t.match(/(?:[\\\/])([\w-]+)\.(\w+?)$/),a=r&&r[1],o=r&&r[2],s=`@font-face {\n        font-family: '${a}';\n        src: url('${t}') format('${{ttf:'truetype',otf:'opentype',eot:'embedded-opentype'}[o]||o}');\n        font-weight: normal;\n        font-style: normal;\n      }`;n.push({fontName:a,rule:s,optionName:e})}}static setFontVariable(e,t){return`--${e}: '${t}'${'font-default'===e?', Arial':''};\n`}static buildProductLabel(e,t){let r=[];return t||(t='np'),t.includes('n')&&r.push(e.name),t.includes('s')&&r.push(e.name2),t.includes('p')&&r.push(e.pkg),r.join(' ')}}
//# sourceMappingURL=utils.js.map
