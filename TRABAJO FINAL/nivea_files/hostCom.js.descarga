'use strict';class HostCom{constructor(){window.addEventListener('message',(e=>{this.receive(e)}),!1),this._callbacks={},this._messageQueue={},this._targetWindow=window.parent,this._targetOrigin=document.referrer||'*'}send(e,t={},s=null){'function'==typeof t&&(s=t,t={}),t.action=e,t._iid=window.name,'function'==typeof s&&(t._mid=Utils.uuid(),this._callbacks[e+t._mid]=[{cb:s,unbind:!0}]),this._targetWindow.postMessage(t,this._targetOrigin)}on(e,t){this._callbacks[e]=this._callbacks[e]||[],this._callbacks[e].push(t),this._checkQueue(e)}one(e,t){this._callbacks[e]=this._callbacks[e]||[],this._callbacks[e].push({cb:t,unbind:!0}),this._checkQueue(e)}off(e,t){Object.entries(this._callbacks).forEach((([s,a])=>{if(!s.startsWith(e))return;const i=a.findIndex((e=>e===t||e.cb===t));i>-1&&a.splice(i,1)}))}receive(e){if(!e||!e.data)return;let t=e.data.action;e.data._mid&&(t+=e.data._mid),this._callbacks[t]?this._processEvent(t,e.data):(this._messageQueue[e.data.action]||(this._messageQueue[e.data.action]=[]),this._messageQueue[e.data.action].push(e.data))}_processEvent(e,t){const s=[];try{this._callbacks[e].forEach(((e,a)=>{let i,c=!1;'function'==typeof e?i=e:(i=e.cb,c=e.unbind),i.call(null,t),c&&s.push(a-s.length)}))}catch(e){console.error(e)}for(let t=0;t<s.length;t++)this._callbacks[e].splice(s[t],1)}_checkQueue(e){this._messageQueue[e]&&0!==this._messageQueue[e].length&&(this._messageQueue[e].forEach((t=>{this._processEvent(e,t)})),delete this._messageQueue[e])}allowLaxTarget(){this._targetOrigin='*'}hasKey(e){return!!(this._callbacks[e]&&this._callbacks[e].length>0)}}window.hostCom=new HostCom;
//# sourceMappingURL=hostCom.js.map
